# 웹 어댑터 구현하기

## 의존성 역전

웹 어댑터는 ‘주도하는’ 혹은 ‘인커밍’ 어댑터다. 제어 흐름은 웹 어댑터에 있는 컨트롤러에서 애플리케이션 계층에 있는 서비스로 흐른다

의존성 역전 원칙이 적용되어있어 제어의 흐름이 왼쪽에서 오른쪽으로 흐르기 때문에 웹 어댑터가 유스케이스를 직접 호출할 수 있다.

어댑터와 유스케이스 사이에 간접 계층인 포트를 추가하는 이유는 애플리케이션 코어가 외부 세계와 통신할 수 있는 곳에 대한 명시적 포트가 필요하기 때문이다.

포트는 아웃고잉 포트이기 때문에 웹 어댑터는 인커밍 어댑터인 동시에 아웃고잉 어댑터가 될 수 있다. 하지만 보통 웹 어댑터는 한 번에 두 가지 역할을 수행하지는 않는다.

한 어댑터가 동시에 두 가지 역할을 하지 못할 이유는 없다.

## 웹 어댑터의 책임

### 웹 어댑터의 역할

1. HTTP 요청을 자바 객체로 매핑
2. 권한 검사
3. 입력 유효성 검증
4. 입력을 유스케이스의 입력 모델로 매핑
5. 유스케이스 호출
6. 유스케이스의 출력을 HTTP로 매핑
7. HTTP 응답을 반환

웹 어댑터의 검증 단계에서는 웹 어댑터의 입력 모델을 유스케이스의 입력 모델로 변환할 수 있다는 것을 검증해야한다.

이후에는 자연스럽게 변환된 입력 모델로 특정한 유스케이스를 호출하는 것으로 연결된다.

어댑터는 유스케이스의 출력을 반환받고, HTTP 응답으로 직렬화해서 전달한다.

웹 어댑터의 책임들은 애플리케이션 계층이 신경 쓰면 안 되는 것이다.

특정 인커밍 어댑터를 생각할 필요 없이 유스케이스를 먼저 구현하면 경계를 흐리게 만들 유혹에 빠지지 않을 수 있다.

## 컨트롤러 나누기

클래스들이 같은 소속이라는 것을 표현하기 위해 같은 패키지 수준이 놔야한다. 너무 적은 것보다는 너무 많은 게 낫다.

시간이 지나면서 컨트롤러에 200줄만 늘어나도 50줄을 파악하는 것에 비해 난이도가 높다.

또한, 모든 연산을 단일 컨트롤러에 넣는 것이 데이터 구조의 재활용을 촉진한다.

전용 모델 클래스들은 컨트롤러의 패키지에 대해 private으로 선언할 수 있기 때문에 실수로 다른 곳에서 재사용될 일이 없다


## 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?

애플리케이션의 웹 어댑터를 구현할 때는 HTTP 요청을 애플리케이션의 유스케이스에 대한 메서드 호출로 변환하고 결과를 다시 HTTP로 변환하고 어떤 도메인 로직도 수행하지 않는 어댑터를 만들고 있다는 점을 염두에 둬야 한다.

