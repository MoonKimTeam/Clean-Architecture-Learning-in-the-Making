# 아키텍처 경계 강제하기

일정 규모 이상의 모든 프로젝트에서는 시간이 지나면서 아키텍처가 서서히 무너지게 된다.

## 경계와 의존성

가장 안쪽에는 도메인 계층이 있다. 애플리케이션 계층은 애플리케이션 서비스 안에 유스케이스를 구현하기 위해 도메인 엔티티에 접근한다.

어댑터는 인커밍 포트를 통해 서비스에 접근하고, 반대로 서비스는 아웃고잉 포트를 통해 어댑터에 접근한다.

설정 계층은 어댑터와 서비스 객체를 생성할 팩터리를 포함하고 있고 의존성 주입 메커니즘을 제공한다.

이 계층에서 각 계층 사이, 안쪽 인접 계층과 바깥쪽 인접 계층 사이에 경계가 있다. 의존성 규칙에 따르면 계층 경계를 넘는 의존성은 항상 안쪽으로 향해야한다.

## 접근 제한자

package-private 제한자는 자바 패키지를 통해 클래스들을 응집적인 ‘모듈’로 만들어 준다. 이러한 모듈 내에 있는 클래스들은 서로 접근가능하지만, 패키지 바깥에서는 접근할 수 없다.

이 때 모듈의 진입점으로 활용될 클래스들만 골라서 public으로 만들면 된다. 이렇게 하면 의존성이 잘못된 방향을 가리켜서 의존성 규칙을 위반할 위험이 줄어든다

package-private 제한자는 몇 개 정도의 클래스로만 이뤄진 작은 모듈에서 가장 효과적이다.


## 컴파일 후 체크

이는 코드가 컴파일된 후에 런타임에 체크한다는 뜻으로, ArchUnit과 같은  도구를 사용해 할 수 있다.

의존성 방향이 기대한 대로 잘 설정돼 있는지 체크할 수 있는 AH를 제공하고, 의존성 규칙 위반을 발견하면 예외를 던진다.

## 빌드 아티팩트

빌드 아티팩트는 빌드 프로세스의 결과물이다.

빌드 도구의 주요한 기능 중 하나는 의존성 해결이다. 

어떤 코드베이스를 빌드 아티팩트로 변환하기 위해 빌드 도구가 가장 먼저 할 일은 코드베이스가 의존하고 있는 모든 아티팩트가 사용 가능한지 확인하는 것이다.

만약 사용 불가능한 것이 있다면 아티팩트 리포지토리로부터 가져오려고 시도한다 . 이마저도 실패한다면 코드를 컴파일도 하기 전에 에러와 함께 빌드가 실패한다.

설정 모듈은 특정 모듈들에 접근할 수 있는 권한을 제공하고, 다른 모듈은 접근할 수 없도록 제한한다. 이는 의존성을 명확히 정의하며 모듈 간 순환 의존성을 방지한다. 모듈을 분리하여 코드 리포지토리 관리나 빌드 스크립트로 의존성을 선언하는 것도 가능하다.

하지만 빌드 스크립트를 유지보수하는 비용이 추가되며, 모듈 간 의존성을 잘 관리하지 못하면 불필요한 복잡성이 발생할 수 있다. 따라서 빌드 모듈로 나누기 전 아키텍처가 안정된 상태인지 확인해야 한다.