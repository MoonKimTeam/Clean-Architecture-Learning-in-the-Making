# 경계 간 매핑하기

매핑에 찬성하는 개발자는 계층 간 매핑을 하지 않으면 두 계층에서 같은 모델을 사용해야 하고, 이는 두 계층 간 결합도를 높인다고 주장한다.

매핑에 반대하는 개발자는 매핑을 하게 되면 보일러플레이트 코드가 많아지고, 유스케이스 대부분이 CRUD 작업에 그쳐 매핑이 과도하다고 주장한다.

두 주장 모두 일리가 있다. 매핑 전략은 상황에 따라 결정해야 한다.

## ‘매핑하지 않기’ 전략

‘매핑하지 않기’ 전략은 모든 계층에서 같은 도메인 모델을 사용하는 방식이다. 예제에서는 Account 클래스가 웹, 애플리케이션, 영속성 계층에서 동일하게 사용된다. 이 전략은 매핑 없이 단일 책임 원칙을 준수하고, 중복된 매핑 코드를 피할 수 있다는 장점이 있다.

하지만, 이 전략은 각 계층의 특수한 요구사항을 처리하기 어렵게 만든다. 예를 들어, 웹 계층에서 JSON 직렬화를 위한 필드가 필요하거나, 영속성 계층에서 ORM 매핑을 위한 추가 애너테이션이 필요한 경우, 계층 간 결합도를 높일 수 있다. 계층 변경 시 전체 계층에 영향을 미칠 가능성이 높아진다.

이 전략은 간단한 CRUD 애플리케이션에는 적합하지만, 계층별 요구사항이 복잡해질수록 제한적이다. 애플리케이션이 점점 복잡해질 경우, 이 전략을 유지하기 어려울 수 있다.

## ‘양방향’ 매핑 전략

‘양방향’ 매핑 전략은 각 계층이 전용 도메인 모델을 가지며, 계층 간 필요한 데이터를 매핑하는 방식이다. 웹 계층에서는 인커밍 포트와 도메인 모델을 매핑하고, 영속성 계층에서는 도메인 모델과 영속성 모델 간 매핑을 수행한다.

이 전략은 매핑 책임을 명확히 하고, 계층 간 결합도를 낮출 수 있는 장점이 있다. 각 계층이 독립적으로 모델을 관리할 수 있어 도메인 로직에 집중할 수 있다. 하지만 매핑 코드와 보일러플레이트 코드가 증가하고, 모델 변경 시 매핑 로직 수정이 필요하다는 단점이 있다.

‘양방향’ 매핑 전략은 모든 상황에 적합한 은총알(silver bullet, 어떤 경우에도 기용가능한 해결책)이 아니며, 간단한 CRUD 유스케이스에는 과도할 수 있다. 각 유스케이스마다 적합한 매핑 전략을 선택해야 한다.

## ‘완전’ 매핑 전략

‘완전’ 매핑 전략은 각 계층마다 별도의 입출력 모델을 사용하는 방식이다. 계층 간 통신 시, 각 계층은 전용 모델을 사용하여 필요한 데이터를 매핑한다. 예를 들어, SendMoneyUseCase는 SendMoneyCommand라는 입력 모델을 통해 데이터를 처리한다.

웹 계층은 입력 데이터를 애플리케이션 계층의 커맨드 객체로 매핑하며, 애플리케이션 계층은 이를 인터페이스에 전달하여 로직을 처리한다. 이 방식은 각 유스케이스에 필요한 유효성 검증과 특화된 모델 사용을 가능하게 한다.

이 전략은 계층 간 독립성을 높이고 다양한 유스케이스를 효율적으로 처리할 수 있지만, 매핑 코드가 늘어나고 구현 복잡도가 증가한다. 그러나 복잡한 요구사항을 처리해야 할 때는 유지보수성과 유연성을 제공하는 적합한 선택이다.

## ‘단방향’ 매핑 전략

‘단방향’ 매핑 전략은 모든 계층의 모델이 같은 상태 인터페이스를 구현하는 방식이다. 이 인터페이스는 도메인 모델의 상태를 캡슐화하며, getter 메서드를 통해 필요한 정보를 제공한다.

도메인 모델은 풍부한 행동을 구현할 수 있고, 애플리케이션 계층 내에서 다양한 작업에 활용된다. 도메인 객체는 상태 인터페이스를 통해 인커밍/아웃고잉 포트에서 기대하는 정보를 제공하므로 별도의 매핑이 필요하지 않다.

각 계층은 상태 인터페이스를 사용하며, 한 방향으로만 매핑하므로 매핑 책임이 명확하다. 하지만 매핑이 계층 간에 확장될 경우, 이 전략은 관리가 어려워질 수 있다.

이 전략은 계층 간 모델이 비슷할 때 효과적이며, 웹 계층에서 추가적인 전용 모델 매핑이 필요하지 않은 상황에 적합하다. 하지만 복잡한 요구사항을 처리할 때는 다른 전략에 비해 제한적일 수 있다.

## 언제 어떤 매핑 전략을 사용할 것인가?

매핑 전략은 특정 상황에 따라 달라져야 한다. 한 가지 전략을 고정된 규칙으로 정의하려는 시도는 지양해야 한다. 간단한 전략으로 시작해 필요한 경우 복잡한 전략으로 전환하는 방식이 유효하다.

변경 유스케이스에서는 완전 매핑 전략을 우선적으로 고려한다. 이를 통해 특정 유스케이스에서 필요하지 않은 필드들을 제거하고 유효성 검증을 명확히 할 수 있다.

애플리케이션과 영속성 계층 간에는 매핑 부담을 줄이기 위해 매핑하지 않기 전략을 우선 적용한다. 그러나 영속성 문제를 처리해야 한다면 양방향 매핑 전략으로 전환할 수 있다.

쿼리 유스케이스에서는 매핑 오버헤드를 줄이기 위해 매핑하지 않기 전략이 적합하다. 하지만 상황에 따라 계층 간 요구사항이 복잡해질 경우 양방향 매핑으로 변경할 수 있다.

효과적인 매핑 전략 사용을 위해 팀 내에서 매핑 가이드라인을 지속적으로 논의하고 수정해야 한다. 이는 개발자들이 전략 선택과 전환에 대한 명확한 기준을 가지도록 돕는다.

* 각 유스케이스에 대해 좁은 포트를 사용하면 유스케이스마다 다른 매핑 전략을 사용할 수 있고, 다른 유스케이스에 영향을 미치지 않으면서 코드를 개선할 수 있기 때문에 특정 상황, 특정 시점에 최선의 전략을 선택할 수 있다.
