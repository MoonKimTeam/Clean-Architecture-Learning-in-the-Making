# 영속성 어댑터 구현하기

## 의존성 역전

<img width="725" alt="스크린샷 2024-11-11 오후 7 57 58" src="https://github.com/user-attachments/assets/9ac34d91-2242-4046-8126-b44a1789d5ea">

육각형 아키텍처에서 영속성 어댑터는 주도되는/아웃고잉 어댑터다. <br>
애플리케이션에 의해 호출될뿐, 애플리케이션을 호출하지는 않는다.

포트는 사실상 애플리케이션 서비스와 영속성 코드 사이의 간접적인 계층이다. <br>
영속성 문제에 신경 쓰지 않고 도메인 코드를 개발하기 위해, 즉 영속성 계층에 대한 코드 의존성을 없애기 위해 이러한 간접 계층을 추가한 것이다.

## 영속성 어댑터의 책임

1. 입력을 받는다.
2. 입력을 데이터베이스 포맷으로 매핑한다.
3. 입력을 데이터베이스로 보낸다.
4. 데이터베이스 출력을 애플리케이션 포맷으로 매핑한다.
5. 출력을 반환한다.

## 포트 인터페이스 나누기

**인터페이스 분리 원칙**은 클라이언트가 오로지 자신이 필요로 하는 메서드만 알면 되도록 넓은 인터페이스를 특화된 인터페이스로 분리해야 한다고 설명한다. <br>
이 원칙을 아웃고잉 포트에 적용해보면 아래와 같은 결과를 얻을 수 있다.

<img width="726" alt="스크린샷 2024-11-11 오후 8 03 31" src="https://github.com/user-attachments/assets/479e2db1-773f-4834-bb46-26b42e0290a7">


## 데이터베이스 트랜잭션은 어떻게 해야할까 ?

트랜잭션 경계는 어디에 위치시켜야 할까 ? <br>
트랜잭션은 하나의 특정한 유스케이스에 대해서 일어나는 모든 쓰기 작업에 걸쳐 있어야한다. 그래야 그중 하나라도 실패할 경우 다 같이 롤백될 수 있기 때문이다. <br>







