# 계층형 아키텍처의 문제

<img width="295" alt="스크린샷 2024-11-03 오후 2 18 42" src="https://github.com/user-attachments/assets/572340e0-34b8-4a61-9b84-50931e32614a">


## 계층형 아키텍처는 데이터 베이스 주도 설계를 유도한다

우리는 보통 비즈니스를 관장하는 규칙이나 정책을 반영한 모델을 만들어서 사용자가 이러한 규칙과 정책을 더욱 편리하게 활용할 수 있게 한다. <br>
이때 우리는 **상태가 아니라 행동**을 중심으로 모델링한다. 행동이 상태를 바꾸는 주체이기 때문에 행동이 비즈니스를 이끈다. <br>
그동안 만들어 본 애플리케이션의 유스케이스를 한번 떠올려보자. 도메인 로직을 먼저 구현했는가 아니면 영속성 계층을 먼저 구현했는가 <br>
아마 데이터베이스의 구조를 먼저 생각하고, 이를 토대로 도메인 로직을 구현했을 것이다.

<img width="586" alt="스크린샷 2024-11-03 오후 2 21 55" src="https://github.com/user-attachments/assets/1582b5ee-76fb-4fa8-af8d-36aa3afd802f">

데이터베이스 중심적인 아키텍처가 만들어지는 가장 큰 원인은 ORM 프레임워크를 사용하기 때문이다. <br>
ORM에 의해 관리되는 엔티티들은 일반적으로 영속성 계층에 둔다. 계층은 아래 방향으로만 접근 가능하기 때문에, 도메인 계층에서는 이런 엔티티에 접근할 수 있다. <br>
**하지만 이렇게 되면 영속성 계층과 도메인 계층 사이에 강한 결합이 생긴다.** <br>
영속성 코드가 사실상 도메인 코드에 녹아들어가서 둘 중 하나만 바꾸는 것이 어려워진다.

## 지름길을 택하기 쉬워진다

<img width="653" alt="스크린샷 2024-11-03 오후 2 23 06" src="https://github.com/user-attachments/assets/7687f8a2-ba70-40b3-8747-03041704d73c">

## 테스트하기 어려워진다

단 하나의 필드를 조작하는것에 불과하더라도 도메인 로직을 웹 계층에 구현하게 된다. <br>
또 웹 계층 테스트에서 도메인 계층뿐만 아니라 영속성 계층도 모킹해야 한다. <br>
시간이 흘러 웹 컴포넌트의 규모가 커지면 다양한 영속성 컴포넌트에 의존성이 많이 쌓이면서 테스트의 복잡도를 높인다.

## 유스케이스를 숨긴다

<img width="645" alt="스크린샷 2024-11-03 오후 2 25 35" src="https://github.com/user-attachments/assets/e2e90cc5-cfd6-4ac6-b700-f2e43ff7617a">

넓은 서비스는 영속성 계층에 많은 의존성을 갖게 되고, 다시 웹 레이어의 많은 컴포넌트가 이 서비스에 의존하게 된다. <br>
그럼 서비스를 테스트하기도 어려워지고 작업해야 할 유스케이스를 책임지는 서비스를 찾기도 어려워진다.

고도로 특화된 좁은 도메인 서비스가 유스케이스 하나씩만 담당하게 한다면 이런 작업들이 얼마나 수월해질까? <br>
UserService에서 사용자 등록 유스케이스를 찾는 대신 RegisterUserService를 바로 열어서 작업을 시작하는 것처럼 말이다.

## 동시 작업이 어려워진다

계층형 아키텍처에서는 모든 것이 영속성 계층 위에 만들어지기 때문에 영속성 계층을 먼저 개발해야 하고, 그다음에 도메인 계층을, 그리고 마지막으로 웹 계층을 만들어야 한다. <br>
렇기 때문에 특정 기능은 동시에 한 명의 개발자만 작업할 수 있다.














